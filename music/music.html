<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<script src="js/jq3.js"></script>
		<script src="js/tools.js"></script>
		<style>
			@keyframes move{
				0%{
					transform: rotate(0deg);
				}
				100%{
					transform: rotate(360deg);
				}
			}
			body{
				margin: 0;
				/*background:seashell;*/
				cursor: default;
			}
			
			#music{
				width: 800px;
				height: 500px;
				background: #fff;
				position: relative;
				left: 200px;
				top: 100px;
				border-radius:5px;
				box-shadow: inset 0 0 3px rgba(0, 0, 0, 0.1), 0 0 8px rgba(0, 0, 0, 0.6);
			}
			#music header{
				width: 100%;
				height: 50px;
				position: absolute;
				left: 0;
				top: 0;
				background:indianred;
				border-radius: 5px 5px 0 0;
			}
			#music header h1{
				position: absolute;
				left: 20px;
				top: 10px;
				margin: 0;
				color:#fff;
				font:20px/1.4 "å¾®è½¯é›…é»‘";
			}
			#music header input{
				position: absolute;
				left: 320px;
				top: 15px;
				width: 160px;
				height: 20px;
				border: 0;
				padding: 0;
				border-radius: 3px;
				outline: none;
				background: seashell;
				font:12px/1.2 "å¾®è½¯é›…é»‘";
				text-indent: 5px;
			}
			#music header .buttons{
				position: absolute;
				right: 20px;
				top: 10px;
			}
			/*----------footer----------*/
			#music footer{
				width: 100%;
				height: 50px;
				position: absolute;
				left: 0;
				bottom: 0;
				background: #f6f6f8;
				border-radius: 0 0 5px 5px;
				border-top:1px solid #ccc;
			}
			#music footer .control{
				height: 100%;
				position: absolute;
				left: 0;
				top: 0;
				margin-left: 10px;
			}
			#music footer .control span{
				float: left;
				width: 26px;
				height: 26px;
				margin: 12px 6px;
				background: url(img/prev.jpg) no-repeat;
				background-size: 100%;
			}
			#music footer .control .next{
				background: url(img/next.jpg) no-repeat;
				background-size: 100%;
			}
			#music footer .control .play{
				width: 30px;
				height: 30px;
				margin-top: 10px;
				background: url(img/play.jpg) no-repeat;
				background-size: 100%;
			}
			#music footer .progBar{
				width: 430px;
				height: 100%;
				position: absolute;
				left: 145px;
				top: 0;
			}
			#music footer .progBar span{
				position: absolute;
				left: 0;
				top: 18px;
				font:12px/1.2 arial;
				color:#777;
				
			}
			#music footer .progBar .all{
				left: 442px;
			}
			#music footer .progBar .bar{
				position: absolute;
				left: 35px;
				top: 24px;
				width: 400px;
				height: 3px;
				background: #999;
				border-radius: 1px;	
			}
			#music footer .progBar .bar .run{
				position: absolute;
				left: 0;
				top: 0;
				width: 0;
				height: 3px;
				background: red;
			}
			#music footer .progBar .bar .cirBut{
				position: absolute;
				left: -5px;
				top: -5px;
				width: 10px;
				height: 10px;
				color:indianred;
				cursor:pointer;
			}
			#music footer .volum{
				width:150px;
				height: 100%;
				position: absolute;
				right:18px;
				top: 0;
			}
			#music footer .volum .icon{
				position: absolute;
				left: 0;
				top: 18px;
				width: 14px;
				height: 14px;
				background: url(img/voice.png) no-repeat;
				background-size: 100%;
				cursor:pointer;
			}
			#music footer .volum .volProgbar{
				position: absolute;
				left:25px;
				top: 24px;
				width: 100px;
				height: 3px;
				background: #999;
				border-radius: 1px;	
			}
			#music footer .volum .volProgbar:hover .voiBut{
				display: block;
			}
			#music footer .volum .volProgbar .curVoice{
				position: absolute;
				left: 0;
				top: 0;
				width: 80px;
				height: 3px;
				background: red;
			}
			#music footer .volum .volProgbar .voiBut{
				position: absolute;
				left: 75px;
				top: -7px;
				width: 10px;
				height: 10px;
				color:indianred;
				cursor:pointer;
				font-size: 12px;
				text-align: center;
				display: none;
			}
			#music footer .volum .loop{
				position: absolute;
				right: 0;
				top: 14px;
			}
			/*----------content--------*/
			#music .content{
				width: 100%;
				height: 400px;
				position: absolute;
				left: 0;
				top: 50px;
			}
			#music .content .list{
				width: 160px;
				height: 100%;
				position: absolute;
				left: 0;
				top: 0;
				border-right: 1px solid #ccc;
			}
			#music .content .list .title{
				width: 100%;
				height: 26px;
				background:rgba(0,0,0,0.2);
				font:14px/26px "å¾®è½¯é›…é»‘";
				text-align: center;
			}
			#music .content .list .song{
				margin: 0;
				padding: 0;
				list-style: none;
				width: 100%;
			}
			#music .content .list .song li{
				height: 24px;
				text-indent: 10px;
				font:12px/24px "å¾®è½¯é›…é»‘";
				color:#777;
			}
			#music .content .list .song li:hover{
				background:rgba(0,0,0,0.1);
			}
			#music .content .list .song .active{
				background:rgba(0,0,0,0.1);
			}
			#music .content .zone{
				width: 640px;
				height: 100%;
				position: absolute;
				left: 160px;
				top: 0;
				background: rgba(0,0,0,0.02);
			}
			#music .content .zone .disk{
				height: 100%;
			}
			#music .content .zone .disk .diskpic{
				position: absolute;
				left: 75px;
				top: 80px;
				width: 260px;
				height: 260px;
				background: url(img/diskpic.png) no-repeat;
				background-size: 100%;
				animation: move 8s linear infinite;
				animation-play-state: paused;
			}
			#music .content .zone .disk .headpic{
				position: absolute;
				left: 120px;
				top: 0;
				width: 105px;
				height: 215px;
				background: url(img/headpic.png) no-repeat;
				background-size: 100%;
				transform: rotate(-80deg);
				transform-origin: 88px 23px;
				transition: 0.5s;
			}
			/*-------æœç´¢ç»“æœ------*/
			.zone .songlist{
				height: 100%;
				position: relative;
				display: none;
			}
			.zone .songlist .head{
				height: 20px;
				padding-top: 10px;
			}
			.zone .songlist .tipsCount{
				height: 20px;
				text-align: center;
				font:14px/20px "å¾®è½¯é›…é»‘";
				color:#666;
				margin-top: 10px;
			}
			.zone .songlist .head span{
				float: left;
				width: 128px;
				text-align: center;
				font:16px/20px "å¾®è½¯é›…é»‘";
				color:#666;
			}
			.zone .songlist .close{
				width: 16px;
				height: 16px;
				position: absolute;
				right: 10px;
				top: 8px;
			}
			.zone .songInfo{
				padding: 0;
				margin: 0;
				margin-top: 10px;
				list-style: none;
			}
			.zone .songInfo li{
				height: 28px;
				margin-bottom: 2px;
			}
			.zone .songInfo li:hover{
				background: rgba(0,0,0,0.1);
			}
			.zone .songInfo li span{
				float: left;
				width: 128px;
				text-align: center;
				font:12px/28px "å¾®è½¯é›…é»‘";
				color:#666;
				white-space: nowrap;  
				text-overflow:ellipsis; 
				overflow:hidden;
			}
		</style>
	</head>
	<body>
		<div id="music">
			<header>
				<h1>æµ·é¸¥éŸ³ä¹</h1>
				<input type="text" placeholder="æœç´¢éŸ³ä¹" id="search"/>
				<div class="buttons">
					<span class="hide">â–</span>
					<span class="close">âœ–</span>
				</div>
			</header>
			<div class="content">
				<div class="list">
					<div class="title">é»˜è®¤åˆ—è¡¨[<strong>5</strong>]</div>
					<ul class="song">
						<li>æ¥ç”Ÿ</li>
						<li>æµ·é˜”å¤©ç©º</li>
						<li>ç‰µä¸çº¿</li>
						<li>ä½ é£åˆ°åŸå¸‚å¦ä¸€è¾¹</li>
						<li>é€ä½ ä¸€æœµå±±èŒ¶èŠ±</li>
					</ul>
				</div>
				<div class="zone">
					<div class="disk">
						<span class="diskpic"></span>
						<span class="headpic"></span>
					</div>
					<div class="songlist">
						<span class="close">âœ–</span>
						<div class="head">
							<span>æ­Œæ‰‹</span>
							<span>æ­Œæ›²å</span>
							<span>ä¸“è¾‘</span>
							<span>æ—¶é—´</span>
							<span>å“è´¨</span>
						</div>
						<div class="tipsCount">ç½‘ç»œè¿æ¥æœ‰é—®é¢˜å“¦...</div>
						<ul class="songInfo"></ul>
					</div>
				</div>
			</div>
			<footer>
				<div class="control">
					<span class="prev"></span>
					<span class="play"></span>
					<span class="next"></span>
				</div>
				<div class="progBar">
					<span class="now">00:00</span>
					<div class="bar">
						<span class="run"></span>
						<span class="cirBut">â—‰</span>
					</div>
					<span class="all">00:00</span>
				</div>
				<div class="volum">
					<span class="icon"></span>
					<span class="volProgbar">
						<span class="curVoice"></span>
						<span class="voiBut">â—‰</span>
					</span>
					<span class="loop">ğŸ”‚</span>
				</div>
			</footer>
		</div>
		<!--ğŸ”€ğŸ”‚ğŸ”â—¼â€–-->
		<audio id="player" src="music/æ¥ç”Ÿ.mp3">è¯·å‡çº§æµè§ˆå™¨</audio>
		<script>
			
			var timer=null,
				now=null,
				nowPlayId=0,  //è®°å½•æ­£åœ¨æ’­æ”¾çš„æ­Œæ›²id
				loopState="loop",
				loopCode=0,
				loopArr=["loop","order","random"],
				loopIconArr=["ğŸ”‚","ğŸ”","ğŸ”€"],
				playlist=[],
				musicJs=null, //ç”¨æ¥æ¥æ”¶æ­Œæ›²çš„jsonp
				num=0;
			var songData=[
				{
					id:0,
					title:"æ¥ç”Ÿ-æç¦",
					src:"music/æ¥ç”Ÿ.mp3"
				},
				{
					id:1,
					title:"æˆ‘è¦æ‰¾åˆ°ä½ -é™ˆæ˜",
					src:"music/æˆ‘è¦æ‰¾åˆ°ä½ .mp3"
				},
				{
					id:2,
					title:"æƒ…éå¾—ä»¥-åº¾æ¾„åº†",
					src:"music/æƒ…éå¾—ä»¥.mp3"
				},
				{
					id:3,
					title:"ä½ çš„èƒŒåŒ…-é™ˆå¥•è¿…",
					src:"music/ä½ çš„èƒŒåŒ….mp3"
				},
				{
					id:4,
					title:"æ–°ä¸äº†æƒ…-è§æ•¬è…¾",
					src:"music/æ–°ä¸äº†æƒ….mp3"
				}
			]
			player.volume=0.8; //è®¾ç½®é»˜è®¤éŸ³é‡
			//æ’­æ”¾æš‚åœ
			$(".control .play").on("click",function(){
				if(player.paused){
					playFlash();
					findList(nowPlayId);
				}else{
					player.pause();
					clearInterval(timer);
					$(".control .play").css("backgroundImage","url(img/play.jpg)");
					$(".diskpic").css("animationPlayState","paused");
					$(".headpic").css("transform","rotate(-80deg)");
				}
				
			})
			//é™éŸ³
			$(".icon").on("click",function(){
				var oriVoice=player.volume;
				if(!player.muted){ 
					this.style.backgroundImage="url(img/novoi.png)";
					$(".curVoice").css("width",0);
					$(".voiBut").css("left",-5);
				}else{
					this.style.backgroundImage="url(img/voice.png)";
					$(".curVoice").css("width",oriVoice*100);
					$(".voiBut").css("left",oriVoice*100-5);
				}
				player.muted=!player.muted;
			})
			//ä¸‹ä¸€é¦–
			$(".next").on("click",function(){
				if(loopState==="loop"){
					loopState="order";
					loopType();
					loopState="loop";
					return;
				}
				loopType();
			})
			//ä¸Šä¸€é¦–
			$(".prev").on("click",function(){
				player.src=songData[nowPlayId].src;
				player.play();
				findList(nowPlayId);
			})
			//æ ¹æ®ä¼ å…¥çš„å‚æ•°æ¥è®¾ç½®è¿›åº¦æ¡çš„æ˜¾ç¤ºæƒ…å†µ
			function changeBar(time,allTime){ 
				var x=time/allTime;
				$(".bar .run").css("width",x*400);
				$(".bar .cirBut").css("left",x*400-5);
			}
			//å°†æ—¶é—´è½¬æ ¼å¼è¾“å‡º
			function transTime(time){
				var minutes=tools.addZero(parseInt(time/60));
				var second=tools.addZero(parseInt(time%60));
				var str=minutes+':'+second;
				return str;
			}
			//æ‹–åŠ¨è°ƒæ•´è¿›åº¦
			$(".cirBut").on("mousedown",function(e){
				var disX=e.clientX-this.offsetLeft;
				clearInterval(timer);
				document.onmousemove=function(e){
					var wid=e.clientX-disX;
					wid=wid<-5?-5:wid;
					wid=wid>395?395:wid;
					now=(wid+5)/400*player.duration;
					$(".cirBut").css("left",wid);
					$(".bar .run").css("width",wid+5);
					$(".progBar .now").text(transTime(now));
					e.preventDefault();
				}
				document.onmouseup=function(){
					player.currentTime=now;
					if(!player.paused){ //æš‚åœæ—¶ä¸å¼€å¯
						current();
					}
					document.onmousemove=null;
					document.onmouseup=null;
				}
			})
			//æ’­æ”¾æ—¶è‡ªåŠ¨æ”¹å˜è¿›åº¦æ¡å’Œæ’­æ”¾æ—¶é—´
			function current(){ 
				timer=setInterval(function(){
					$(".progBar .now").text(transTime(player.currentTime));
					changeBar(player.currentTime,player.duration);
					if(player.ended){
						loopType();
					}
				},500)
			}
			//ç‚¹å‡»è¿›åº¦æ¡æ§åˆ¶è¿›åº¦
			$(".bar").on("click",function(e){
				clearInterval(timer);
				var left=this.getBoundingClientRect().left;
				var timeRange=e.clientX-left;
				timeRange=timeRange<0?0:timeRange;
				timeRange=timeRange>400?400:timeRange;
				$(".bar .run").css("width",timeRange);
				$(".bar .cirBut").css("left",timeRange-5);
				now=(timeRange)/400*player.duration;
				player.currentTime=now;
				$(".progBar .now").text(transTime(now));
				current();
			})
			//ç‚¹å‡»è°ƒæ•´éŸ³é‡
			$(".volProgbar").on("click",function(e){
				var left=this.getBoundingClientRect().left;
				var voiceRange=e.clientX-left;
				voiceRange=voiceRange<0?0:voiceRange;
				voiceRange=voiceRange>100?100:voiceRange;
				$(".curVoice").css("width",voiceRange);
				$(".voiBut").css("left",voiceRange-5);
				if(player.muted){
					player.muted=!player.muted;
				}
				player.volume=(voiceRange)/100;
				if(voiceRange===0){ //ç‚¹å‡»é›¶ç‚¹åˆ‡æ¢å›¾æ ‡
					$(".icon").css("backgroundImage","url(img/novoi.png)");
				}else{
					$(".icon").css("backgroundImage","url(img/voice.png)");
				}
			})
			
			//æ‹–åŠ¨è°ƒæ•´éŸ³é‡
			$(".voiBut").on("mousedown",function(e){
				var disX=e.clientX-this.offsetLeft;
				document.onmousemove=function(e){
					var voiceRange=e.clientX-disX;
					voiceRange=voiceRange<-5?-5:voiceRange;
					voiceRange=voiceRange>95?95:voiceRange;
					if(player.muted){
						player.muted=!player.muted;
					}
					player.volume=(voiceRange+5)/100;
					$(".voiBut").css("left",voiceRange);
					$(".curVoice").css("width",voiceRange+5);
					if(voiceRange===-5){ //æ»‘åŠ¨åˆ°é›¶ç‚¹åˆ‡æ¢å›¾æ ‡
						$(".icon").css("backgroundImage","url(img/novoi.png)");
					}else{
						$(".icon").css("backgroundImage","url(img/voice.png)");
					}
					e.preventDefault();
				}
				document.onmouseup=function(){
					document.onmousemove=null;
					document.onmouseup=null;
				}
			})
			//åŒå‡»èœå•é€‰æ­Œ
			$(".song").on("dblclick","li",function(e){
				$(".song li").removeClass("active");
				$(this).addClass("active");
				player.src=this.dataset.src;
				playFlash();
				e.preventDefault();
			})
			//ç”Ÿæˆæ­Œæ›²åˆ—è¡¨
			function createList(data){
				var str="";
				data.forEach(function(item){
					str+="<li data-src="+item.src+" data-id="+item.id+">"+item.title+"</li>"
				})
				$(".song").html(str);
			}
			
			function loopType(){
				if(loopState==="loop"){
					player.loop=true;
				}
				if(loopState==="order"){ //åˆ—è¡¨é¡ºåºæ’­æ”¾
					player.loop=false;
					nowPlayId++;
					nowPlayId%=songData.length;
					player.src=songData[nowPlayId].src;
				}
				if(loopState==="random"){ //åˆ—è¡¨éšæœºæ’­æ”¾
					player.loop=false;
					nowPlayId=parseInt(Math.random()*100);
					nowPlayId%=songData.length;
					player.src=songData[nowPlayId].src;
				}
				playFlash();
				findList(nowPlayId);
			}
			$(".loop").on("click",function(e){
				
				loopCode++;
				loopCode%=3;
				player.loop=loopCode===0?true:false;
				loopState=loopArr[loopCode];
				$(this).text(loopIconArr[loopCode]);
			})
			function playFlash(){ //ä»»ä½•é€”å¾„æ’­æ”¾è¦åšçš„åŠ¨ç”»
				player.play();
				current();
				$(".control .play").css("backgroundImage","url(img/pause.jpg)");
				$(".diskpic").css("animationPlayState","running");
				$(".headpic").css("transform","rotate(-55deg)");
			}
			
			createList(songData);
			player.ondurationchange=function(){  //åˆ‡æ¢æ­Œæ›²æ—¶durationæ”¹å˜
				$(".progBar .all").text(transTime(player.duration));
				playlist.push(nowPlayId);
				console.log(playlist);
			}
			//æ ¹æ®ä¼ å…¥çš„idç»™æ­Œå•åŠ class
			function findList(id){
				var lis=$(".song")[0].getElementsByTagName("li");
				for (var i = 0; i < lis.length; i++){
					if(lis[i].dataset.id==id){
						$(".song li").removeClass("active");
						$(lis[i]).addClass("active");
					}
				}
			}
			//æœç´¢æ­Œæ›²
			$("#search").on("keyup",function(e){
				if(e.keyCode===13){
					if(this.value.trim()===""){
						return
					}
					$(".disk").hide();
					$(".songlist").show();
					ask(1);
				}
			})
			//å…³é—­æœç´¢æ­Œæ›²èœå•
			$(".songlist .close").on("click",function(){
				$(".disk").show();
				$(".songlist").hide();
			})
			$(".songlist").on("dblclick","li",function(){
				songData.push({
					id:songData.length,
					title:$(this).find("span").eq(1).html()+"-"+$(this).find("span").eq(0).html(),
					src:this.dataset.src
				})
				createList(songData);
				player.src=this.dataset.src;
				playFlash();
				$(".song li").removeClass("active");
				$(".song li:last").addClass("active");
			})
			
			function ask(n){
				musicJs=document.createElement("script");
				musicJs.src="http://search.dongting.com/song/search/old?q="+search.value+"&page="+n+"&size=10&callback=result";
				document.body.appendChild(musicJs);
			}
			function result(data){
				var str='';
				$(".tipsCount").text("æœç´¢"+search.value+"ï¼Œæ‰¾åˆ°"+data.data.length+"é¦–å•æ›²");
				for (var i = 0; i < data.data.length; i++) {
					data.data[i].album_name=data.data[i].album_name?data.data[i].album_name:"æœªæ‰¾åˆ°ä¸“è¾‘";
					str+="<li data-src='"+data.data[i].url_list[1].url+"'><span>"+data.data[i].singer_name+"</span><span>"+data.data[i].song_name+"</span><span>"+data.data[i].album_name+"</span><span>"+data.data[i].url_list[1].duration+"</span><span>"+data.data[i].url_list[1].typeDescription+"</span></li>";
				}
				$(".songInfo").html(str);
				document.body.removeChild(musicJs);
			}
		</script>
	</body>
</html>
